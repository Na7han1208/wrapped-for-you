<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Us Wrapped</title>
<link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;700;900&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
:root { --font:'Helvetica Neue','Arial Black',sans-serif; }
html,body { width:100%;height:100%;overflow:hidden;background:#000;font-family:var(--font); }

#app { width:100%;height:100vh;position:relative;overflow:hidden; }

/* â”€â”€ SLIDES â”€â”€ */
.slide {
  position:absolute;inset:0;display:flex;flex-direction:column;
  justify-content:flex-end;padding:48px 36px 56px;
  opacity:0;pointer-events:none;overflow:hidden;
  transition:opacity .55s cubic-bezier(.77,0,.18,1),transform .55s cubic-bezier(.77,0,.18,1);
  transform:translateX(100%);
}
.slide.active  { opacity:1;pointer-events:all;transform:translateX(0); }
.slide.exit-left { opacity:0;transform:translateX(-60%); }

/* gradients */
.slide-val  { background:linear-gradient(160deg,#1a1a2e 0%,#16213e 40%,#0f3460 100%); }
.slide-s1   { background:linear-gradient(160deg,#ff416c 0%,#ff4b2b 100%); }
.slide-s2   { background:linear-gradient(160deg,#f7971e 0%,#ffd200 100%); }
.slide-s3   { background:linear-gradient(160deg,#56ccf2 0%,#2f80ed 100%); }
.slide-s4   { background:linear-gradient(160deg,#6a3093 0%,#a044ff 100%); }
.slide-s5   { background:linear-gradient(160deg,#11998e 0%,#38ef7d 100%); }
.slide-s6   { background:linear-gradient(160deg,#fc5c7d 0%,#6a3093 100%); }
.slide-s7   { background:linear-gradient(160deg,#f953c6 0%,#b91d73 100%); }
.slide-s8   { background:linear-gradient(160deg,#4facfe 0%,#00f2fe 100%); }
.slide-s9   { background:linear-gradient(160deg,#fd746c 0%,#ff9068 100%); }
.slide-s10  { background:linear-gradient(160deg,#1DB954 0%,#191414 100%); }
.slide-no   { background:linear-gradient(160deg,#232526 0%,#414345 100%); }

/* noise */
.slide::before {
  content:'';position:absolute;inset:0;pointer-events:none;mix-blend-mode:overlay;opacity:.3;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.08'/%3E%3C/svg%3E");
  background-size:200px;
}

/* deco number */
.slide-deco {
  position:absolute;top:-30px;right:-20px;
  font-size:clamp(160px,45vw,280px);font-weight:900;line-height:1;
  opacity:.12;letter-spacing:-8px;user-select:none;color:#fff;pointer-events:none;
}

/* us wrapped label */
.us-label {
  position:absolute;top:36px;left:36px;z-index:10;
  font-size:13px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;
  color:rgba(255,255,255,.85);
}
.us-label.dark { color:rgba(0,0,0,.65); }

/* progress dots */
.progress-dots { position:absolute;top:36px;right:36px;display:flex;gap:5px;z-index:10; }
.dot { width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.3);transition:all .3s; }
.dot.active { background:#fff;width:20px;border-radius:3px; }
.dot.dark { background:rgba(0,0,0,.2); }
.dot.dark.active { background:rgba(0,0,0,.6); }

/* content */
.slide-tag {
  display:inline-block;font-size:11px;font-weight:700;letter-spacing:.15em;text-transform:uppercase;
  color:rgba(255,255,255,.7);margin-bottom:12px;background:rgba(255,255,255,.15);
  padding:4px 12px;border-radius:20px;width:fit-content;
}
.slide-tag.dark { color:rgba(0,0,0,.55);background:rgba(0,0,0,.1); }

.slide-title {
  font-size:clamp(38px,10vw,68px);font-weight:900;color:#fff;
  line-height:.95;letter-spacing:-2px;margin-bottom:14px;
}
.slide-title.dark { color:#000; }

.slide-subtitle {
  font-size:clamp(15px,3.8vw,21px);font-weight:700;color:rgba(255,255,255,.75);
  margin-bottom:10px;letter-spacing:-.3px;
}
.slide-subtitle.dark { color:rgba(0,0,0,.65); }

.slide-text {
  font-size:clamp(13px,3vw,15px);color:rgba(255,255,255,.6);
  line-height:1.6;max-width:340px;margin-bottom:24px;
}
.slide-text.dark { color:rgba(0,0,0,.5); }

/* song card */
.song-card {
  display:flex;align-items:center;gap:14px;
  background:rgba(0,0,0,.28);backdrop-filter:blur(12px);
  border-radius:12px;padding:12px 16px;border:1px solid rgba(255,255,255,.12);
}
.song-card.dark { background:rgba(0,0,0,.1);border-color:rgba(0,0,0,.08); }
.song-art {
  width:48px;height:48px;border-radius:6px;background:rgba(255,255,255,.2);
  flex-shrink:0;display:flex;align-items:center;justify-content:center;
}
.song-art.dark { background:rgba(0,0,0,.15); }
.song-art svg { width:22px;height:22px;opacity:.8; }
.song-info { flex:1;min-width:0; }
.song-name { font-size:13px;font-weight:700;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis; }
.song-name.dark { color:#000; }
.song-artist { font-size:11px;color:rgba(255,255,255,.55);margin-top:2px; }
.song-artist.dark { color:rgba(0,0,0,.45); }
.play-btn {
  width:36px;height:36px;border-radius:50%;background:#1DB954;border:none;cursor:pointer;
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  transition:transform .15s,background .2s;
}
.play-btn:hover { transform:scale(1.1);background:#1ed760; }
.play-btn svg { width:14px;height:14px;margin-left:2px; }

/* nav */
.nav-area { position:absolute;bottom:0;left:0;right:0;height:42%;display:flex;z-index:5;pointer-events:none; }
.nav-prev,.nav-next { flex:1;pointer-events:all;cursor:pointer;background:transparent;border:none;-webkit-tap-highlight-color:transparent; }

/* valentine */
.valentine-center {
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100%;text-align:center;padding:40px 36px;
}
.heart-deco { font-size:80px;margin-bottom:22px;animation:hb 1.4s ease-in-out infinite; }
@keyframes hb { 0%,100%{transform:scale(1)} 14%{transform:scale(1.15)} 28%{transform:scale(1)} 42%{transform:scale(1.1)} }
.valentine-title {
  font-size:clamp(34px,9vw,58px);font-weight:900;color:#fff;
  letter-spacing:-2px;line-height:1;margin-bottom:10px;
}
.valentine-sub { font-size:15px;color:rgba(255,255,255,.6);margin-bottom:44px;font-weight:500; }
.btn-group { display:flex;gap:14px;width:100%;max-width:280px; }
.btn-yes,.btn-no { flex:1;padding:15px;border-radius:50px;font-size:15px;font-weight:800;cursor:pointer;border:none;transition:transform .15s; }
.btn-yes { background:#1DB954;color:#000; }
.btn-no  { background:rgba(255,255,255,.15);color:#fff;border:1px solid rgba(255,255,255,.3); }
.btn-yes:hover { transform:scale(1.04);background:#1ed760; }
.btn-no:hover  { transform:scale(1.04);background:rgba(255,255,255,.22); }

/* no slide */
.no-center { display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;text-align:center;padding:40px; }
.no-emoji { font-size:72px;margin-bottom:20px; }
.no-title { font-size:clamp(30px,8vw,50px);font-weight:900;color:#fff;letter-spacing:-1.5px;margin-bottom:12px; }
.no-text  { font-size:15px;color:rgba(255,255,255,.55);line-height:1.6;max-width:280px;margin-bottom:32px; }
.btn-retry { padding:13px 32px;border-radius:50px;font-size:14px;font-weight:800;cursor:pointer;border:1.5px solid rgba(255,255,255,.35);background:transparent;color:#fff;transition:all .2s; }
.btn-retry:hover { background:rgba(255,255,255,.1);transform:scale(1.04); }

/* swipe hint */
.swipe-hint {
  position:absolute;bottom:20px;left:50%;transform:translateX(-50%);
  font-size:10px;color:rgba(255,255,255,.35);letter-spacing:.12em;text-transform:uppercase;
  pointer-events:none;z-index:10;animation:fud 2.5s ease-in-out infinite;white-space:nowrap;
}
.swipe-hint.dark { color:rgba(0,0,0,.25); }
@keyframes fud { 0%,100%{opacity:.4;transform:translateX(-50%) translateY(0)} 50%{opacity:.8;transform:translateX(-50%) translateY(-4px)} }

/* slide-in anims */
.slide.active .slide-tag     { animation:sup .6s cubic-bezier(.22,1,.36,1) .1s both; }
.slide.active .slide-title   { animation:sup .6s cubic-bezier(.22,1,.36,1) .18s both; }
.slide.active .slide-subtitle{ animation:sup .6s cubic-bezier(.22,1,.36,1) .26s both; }
.slide.active .slide-text    { animation:sup .6s cubic-bezier(.22,1,.36,1) .32s both; }
.slide.active .song-card     { animation:sup .6s cubic-bezier(.22,1,.36,1) .4s both; }
@keyframes sup { from{opacity:0;transform:translateY(28px)} to{opacity:1;transform:translateY(0)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EDITOR MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#editor-overlay {
  display:none;position:fixed;inset:0;z-index:1000;
  background:rgba(0,0,0,.88);backdrop-filter:blur(18px);
  align-items:center;justify-content:center;padding:20px;
}
#editor-overlay.open { display:flex; }
#editor-box {
  background:#161616;border-radius:18px;width:100%;max-width:560px;
  max-height:90vh;overflow-y:auto;padding:30px;
  border:1px solid rgba(255,255,255,.1);
  scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.15) transparent;
}
#editor-box h2 { font-size:19px;font-weight:900;color:#fff;margin-bottom:4px; }
#editor-box .ed-sub { font-size:12px;color:rgba(255,255,255,.35);margin-bottom:22px; }
.ed-slide-label { font-size:11px;font-weight:800;letter-spacing:.12em;text-transform:uppercase;color:#1DB954;margin:22px 0 8px; }
.ed-section-divider { height:1px;background:rgba(255,255,255,.07);margin-bottom:14px; }
.ed-row { margin-bottom:11px; }
.ed-row label { display:block;font-size:11px;color:rgba(255,255,255,.45);margin-bottom:5px;font-weight:600;letter-spacing:.04em; }
.ed-row input,.ed-row textarea {
  width:100%;background:#222;border:1px solid rgba(255,255,255,.1);border-radius:9px;
  padding:10px 13px;color:#fff;font-size:13px;font-family:var(--font);outline:none;
  transition:border-color .2s;
}
.ed-row input:focus,.ed-row textarea:focus { border-color:#1DB954; }
.ed-row textarea { resize:vertical;min-height:64px; }
.ed-hint { font-size:11px;color:rgba(255,255,255,.28);margin-top:4px; }
.ed-actions { display:flex;gap:10px;margin-top:24px;position:sticky;bottom:0;padding-top:12px;background:#161616; }
.ed-save  { flex:1;padding:14px;border-radius:50px;background:#1DB954;color:#000;font-weight:800;font-size:14px;border:none;cursor:pointer;transition:background .2s; }
.ed-save:hover  { background:#1ed760; }
.ed-close { padding:14px 22px;border-radius:50px;background:rgba(255,255,255,.1);color:#fff;font-weight:700;font-size:14px;border:none;cursor:pointer;transition:background .2s; }
.ed-close:hover { background:rgba(255,255,255,.18); }



@media(max-width:400px){
  .slide{padding:32px 22px 50px;}
  .us-label{top:22px;left:22px;} .progress-dots{top:22px;right:22px;}
}
</style>
</head>
<body>
<div id="app">

<!-- â•â•â• VALENTINE SLIDE â•â•â• -->
<div class="slide slide-val active" id="slide-val">
  <div class="us-label">Us Wrapped</div>
  <div class="slide-deco">â™¡</div>
  <div class="valentine-center">
    <div class="heart-deco">â¤ï¸</div>
    <h1 class="valentine-title" id="val-title">Nina, will you be my Valentine?</h1>
    <p class="valentine-sub" id="val-sub">From: Nathan</p>
    <div class="btn-group">
      <button class="btn-yes" onclick="goYes()">Yes</button>
      <button class="btn-no"  onclick="goNo()">No</button>
    </div>
  </div>
</div>

<!-- â•â•â• NO SLIDE â•â•â• -->
<div class="slide slide-no" id="slide-no">
  <div class="us-label">Us Wrapped</div>
  <div class="no-center">
    <div class="no-emoji">ğŸ’”</div>
    <h1 class="no-title">Damn.</h1>
    <p class="no-text">I'm not going to pretend like that didn't hurt.</p>
    <button class="btn-retry" onclick="backToStart()">â† Let me reconsider</button>
  </div>
</div>

<!-- story slides injected by JS -->
</div>

<!-- â•â•â• EDITOR MODAL â•â•â• -->
<div id="editor-overlay">
  <div id="editor-box">
    <h2>âœï¸ Edit Slides</h2>
    <p class="ed-sub">Edit your slides then save.</p>
    <div id="editor-fields"></div>
    <div class="ed-actions">
      <button class="ed-save"  onclick="saveEdits()">âœ“ Save Changes</button>
      <button class="ed-close" onclick="closeEditor()">Cancel</button>
    </div>
  </div>
</div>



<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SLIDE DATA
//  - videoId: the bit after youtube.com/watch?v=
//  - dark: true = black text (for light gradient slides)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SLIDES = [
  {
    tag:'Chapter One', title:'First Meeting',
    subtitle:'Ever since I met you',
    text:'I knew I wanted to spend every day learning everything about you. Every little detail, even the ones you hate. You are the most interesting person I have met and I cannot believe I am lucky enough to even know you.',
    songTitle:'So Easy (to Fall In Love)', songArtist:'Olivia Dean',
    song:'Song1.mp3', dark:false
  },
  {
    tag:'Chapter Two', title:'I have always known',
    subtitle:'From the Start',
    text:'I have been in love with you since I put my hand against your cheek to fix your piercing at Alexanders party.',
    songTitle:'From the Start', songArtist:'Laufey',
    song:'Song2.mp3', dark:true
  },
  {
    tag:'Chapter Three', title:'I love doing things with you.',
    subtitle:'You are amazing at planning dates',
    text:'Going to the beach, or on a walk, or to a bar, or to a restaurant, or to the Botanical Gardens, or playing Mario Kart, or playing Overcooked, or going on a drive, or literally anything if it involves you.',
    songTitle:'Radio', songArtist:'Bershey',
    song:'Song3.mp3', dark:false
  },
  {
    tag:'Chapter Four', title:'I love you so much',
    subtitle:'You are the best person I have ever met',
    text:'I love your empathy, I love your kindness, I love the way you care about your friends and relationships, and I love how thoughtful you are.',
    songTitle:'Here, There And Everywhere', songArtist:'Queen',
    song:'Song4.mp3', dark:false
  },
  {
    tag:'Chapter Five', title:'Being with you has made me a better boyfriend.',
    subtitle:'And a better person',
    text:'You have a beautiful way of showing affection. I have never met anyone who has made me feel more confident in myself, or felt happier. You are the best influence on me ever.',
    songTitle:'Kiss Me', songArtist:'Sixpence None The Richer',
    song:'Song5.mp3', dark:true
  },
  {
    tag:'Chapter Six', title:'You are my Valentine!',
    subtitle:'And you will be forever',
    text:'I know in my heart that we are perfect for each other, in every way. So no matter what happens, no matter what life throws at us, we will always be in each others lives, and we will always love each other, and you will always be my Valentine.',
    songTitle:'Valentine', songArtist:'Laufey',
    song:'Song6.mp3', dark:false
  },
];

const GRAD = ['slide-s1','slide-s2','slide-s3','slide-s4','slide-s5','slide-s6'];
const TOTAL = SLIDES.length;
let currentIdx = -1;
let touchStartX = 0, touchStartY = 0;
const audio = new Audio();
audio.volume = 0.8;
audio.preload = "none";

// â”€â”€ BUILD SLIDES â”€â”€
function buildSlides() {
  const app = document.getElementById('app');
  SLIDES.forEach((s, i) => {
    const num = i + 1;
    const d = s.dark;
    const isLast = i === TOTAL - 1;
    const el = document.createElement('div');
    el.className = `slide ${GRAD[i]}`;
    el.id = `slide-${num}`;
    el.innerHTML = `
      <div class="us-label${d?' dark':''}">Us Wrapped</div>
      <div class="progress-dots" id="dots-${num}"></div>
      <div class="slide-deco">${String(num).padStart(2,'0')}</div>
      <span class="slide-tag${d?' dark':''}" data-field="tag">${s.tag}</span>
      <h1   class="slide-title${d?' dark':''}" data-field="title">${s.title}</h1>
      <p    class="slide-subtitle${d?' dark':''}" data-field="subtitle">${s.subtitle}</p>
      <p    class="slide-text${d?' dark':''}" data-field="text">${s.text}</p>
      <div class="song-card${d?' dark':''}">
        <div class="song-art${d?' dark':''}">
          <svg viewBox="0 0 24 24" fill="${d?'#000':'#fff'}">
            <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
          </svg>
        </div>
        <div class="song-info">
          <div class="song-name${d?' dark':''}" data-field="songTitle">${s.songTitle}</div>
          <div class="song-artist${d?' dark':''}" data-field="songArtist">${s.songArtist}</div>
        </div>
        <button class="play-btn" onclick="openSong(${i})">
          <svg viewBox="0 0 24 24" fill="#000"><path d="M8 5v14l11-7z"/></svg>
        </button>
      </div>
      <div class="nav-area">
        <div class="nav-prev" onclick="prevSlide()"></div>
        <div class="nav-next" onclick="${isLast?'':'nextSlide()'}"></div>
      </div>
      <div class="swipe-hint${d?' dark':''}">${isLast?'â† swipe back':'â† swipe â†’'}</div>`;
    app.appendChild(el);
  });
  buildDots();
}

function buildDots() {
  SLIDES.forEach((s, i) => {
    const el = document.getElementById(`dots-${i+1}`);
    if (!el) return;
    el.innerHTML = '';
    for (let k = 0; k < TOTAL; k++) {
      const dot = document.createElement('div');
      dot.className = `dot${k===i?' active':''}${s.dark?' dark':''}`;
      el.appendChild(dot);
    }
  });
}

buildSlides();

// â”€â”€ AUDIO (direct MP3) â”€â”€
function playSong(filename) {
  if (!filename) return;
  audio.pause();
  audio.src = filename;
  audio.currentTime = 0;
  audio.play().catch(e => console.warn('Audio play failed:', e));
}

function openSong(idx) {
  const src = SLIDES[idx].song;
  if (!src) {
    alert('No song set for this slide.\nPress P to open the editor and add a filename like Song1.mp3');
    return;
  }
  // Just replay from start if already the current song, otherwise open file
  audio.pause();
  audio.src = src;
  audio.currentTime = 0;
  audio.play().catch(e => console.warn('play failed:', e));
}

// â”€â”€ SLIDE TRANSITIONS â”€â”€
function showSlide(id, dir='forward') {
  const all = document.querySelectorAll('.slide');
  const target = document.getElementById(id);
  all.forEach(s => {
    if (s === target || !s.classList.contains('active')) return;
    s.classList.remove('active');
    if (dir === 'forward') s.classList.add('exit-left');
    else s.style.transform = 'translateX(100%)';
    setTimeout(() => { s.classList.remove('exit-left'); s.style.transform = ''; }, 600);
  });
  target.classList.remove('exit-left');
  target.style.transform = dir === 'forward' ? 'translateX(100%)' : 'translateX(-60%)';
  requestAnimationFrame(() => requestAnimationFrame(() => {
    target.style.transition = 'opacity .55s cubic-bezier(.77,0,.18,1),transform .55s cubic-bezier(.77,0,.18,1)';
    target.classList.add('active');
    target.style.transform = '';
  }));
}

// â”€â”€ NAV â”€â”€
function goYes() {
  currentIdx = 0;
  showSlide('slide-1');
  playSong(SLIDES[0].song); // slide 1 song starts on Yes tap
}
function goNo() {
  currentIdx = -2;
  showSlide('slide-no');
  audio.pause(); audio.src = '';
}
function backToStart() {
  currentIdx = -1;
  showSlide('slide-val', 'backward');
  audio.pause(); audio.src = '';
}
function nextSlide() {
  if (currentIdx < 0 || currentIdx >= TOTAL - 1) return;
  currentIdx++;
  showSlide(`slide-${currentIdx + 1}`);
  playSong(SLIDES[currentIdx].song);
}
function prevSlide() {
  if (currentIdx <= 0) return;
  currentIdx--;
  showSlide(`slide-${currentIdx + 1}`, 'backward');
  playSong(SLIDES[currentIdx].song);
}

// â”€â”€ SWIPE â”€â”€
const app = document.getElementById('app');
app.addEventListener('touchstart', e => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
}, { passive:true });
app.addEventListener('touchend', e => {
  if (currentIdx < 0) return;
  const dx = e.changedTouches[0].clientX - touchStartX;
  const dy = e.changedTouches[0].clientY - touchStartY;
  if (Math.abs(dx) < Math.abs(dy) * 1.5 || Math.abs(dx) < 40) return;
  if (dx < 0) nextSlide(); else prevSlide();
}, { passive:true });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EDITOR  (press P)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openEditor() {
  const box = document.getElementById('editor-fields');
  box.innerHTML = '';

  // Valentine section
  box.innerHTML += `
    <div class="ed-slide-label">Valentine Slide</div>
    <div class="ed-section-divider"></div>
    <div class="ed-row">
      <label>Big Title</label>
      <input type="text" id="ef-val-title" value="${esc(document.getElementById('val-title').textContent)}">
    </div>
    <div class="ed-row">
      <label>Subtitle / tagline</label>
      <input type="text" id="ef-val-sub" value="${esc(document.getElementById('val-sub').textContent)}">
    </div>
  `;

  SLIDES.forEach((s, i) => {
    box.innerHTML += `
      <div class="ed-slide-label">Slide ${i+1}</div>
      <div class="ed-section-divider"></div>
      <div class="ed-row">
        <label>Chapter Tag</label>
        <input type="text" id="ef-${i}-tag" value="${esc(s.tag)}">
      </div>
      <div class="ed-row">
        <label>Title</label>
        <input type="text" id="ef-${i}-title" value="${esc(s.title)}">
      </div>
      <div class="ed-row">
        <label>Subtitle</label>
        <input type="text" id="ef-${i}-subtitle" value="${esc(s.subtitle)}">
      </div>
      <div class="ed-row">
        <label>Body Text</label>
        <textarea id="ef-${i}-text">${esc(s.text)}</textarea>
      </div>
      <div class="ed-row">
        <label>Song Name (shown on card)</label>
        <input type="text" id="ef-${i}-songTitle" value="${esc(s.songTitle)}">
      </div>
      <div class="ed-row">
        <label>Artist Name</label>
        <input type="text" id="ef-${i}-songArtist" value="${esc(s.songArtist)}">
      </div>
      <div class="ed-row">
        <label>Song Filename</label>
        <input type="text" id="ef-${i}-videoId" value="${esc(s.song)}" placeholder="e.g. Song1.mp3">
        <div class="ed-hint">Upload MP3s to your repo root and enter the filename</div>
      </div>`;
  });

  document.getElementById('editor-overlay').classList.add('open');
}

function saveEdits() {
  // Valentine
  document.getElementById('val-title').textContent = document.getElementById('ef-val-title').value;
  document.getElementById('val-sub').textContent   = document.getElementById('ef-val-sub').value;

  // Slides
  SLIDES.forEach((s, i) => {
    ['tag','title','subtitle','text','songTitle','songArtist','song'].forEach(f => {
      const inputId = f === 'song' ? `ef-${i}-videoId` : `ef-${i}-${f}`;
      const input = document.getElementById(inputId);
      if (!input) return;
      s[f] = input.value;
      // Update live DOM text nodes
      const slideEl = document.getElementById(`slide-${i+1}`);
      if (!slideEl) return;
      const domEl = slideEl.querySelector(`[data-field="${f}"]`);
      if (domEl) domEl.textContent = s[f];
    });
  });

  closeEditor();
}

function closeEditor() {
  document.getElementById('editor-overlay').classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXPORT  (press O) â€” downloads a fresh HTML
//  with all your edits baked in
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportHTML() {
  // Serialise SLIDES data back into a new <script> block
  const slidesJSON = JSON.stringify(SLIDES, null, 2);

  // Grab the whole page and swap the SLIDES constant with the current data
  const originalHTML = document.documentElement.outerHTML;
  const updated = originalHTML.replace(
    /const SLIDES = \[[\s\S]*?\];/,
    `const SLIDES = ${slidesJSON};`
  );

  const blob = new Blob([updated], { type:'text/html' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'us-wrapped.html';
  a.click();
  setTimeout(() => URL.revokeObjectURL(a.href), 1000);
}

// â”€â”€ HELPERS â”€â”€
function esc(str) {
  return String(str).replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}


// â”€â”€ KEYBOARD â”€â”€
document.addEventListener('keydown', e => {
  const tag = document.activeElement.tagName;
  const typing = tag === 'INPUT' || tag === 'TEXTAREA';

  if (e.key === 'Escape') { closeEditor(); return; }
  if (typing) return;

  const k = e.key.toLowerCase();
  if (k === 'p') { openEditor(); return; }
  if (k === 'o') { exportHTML(); return; }
  if (e.key === 'ArrowRight') nextSlide();
  if (e.key === 'ArrowLeft')  prevSlide();
  if (e.key === 'Enter' && currentIdx === -1) goYes();
});
</script>
</body>
</html>
